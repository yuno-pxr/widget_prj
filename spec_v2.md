# The Monolith - 仕様書 (v2)

## 1. アプリケーション基本動作

### 1.1 ウィンドウ制御
*   **外観**: フレームレス、背景透過、最前面固定（Always on Top）。
*   **移動**: ウィンドウ上部のヘッダー領域（"MONOLITH // SYSTEM READY" 表示部など）をドラッグすることで、デスクトップ上の任意の位置へ移動可能とする。
    *   *技術要件*: CSSの `-webkit-app-region: drag` を適切に適用し、入力エリアなどの操作可能領域は `no-drag` で除外する。

### 1.2 ドラッグ＆ドロップ (D&D)
*   **対象**: テキストファイル、画像、動画、音声ファイル、およびブラウザからのURL。
*   **挙動**:
    *   アプリ領域へのファイルドロップ時、ブラウザのデフォルト挙動（ファイルを開いてプレビュー）を**完全に無効化**する。
    *   ドロップされたファイルの「ファイルパス」のみを取得し、内部データとして保持する。
    *   **視覚効果**: ドロップ直後、ファイルアイコンがアプリ内に吸い込まれて消えるようなアニメーションを表示し、ユーザーに入力を受け付けたことをフィードバックする。

## 2. インターフェース仕様

### 2.1 メイン画面構成
画面は上から順に以下の要素で構成する。

1.  **Header (Drag Area)**
    *   アプリの移動用ハンドル。
    *   システムステータス表示（待機中 / 処理中 など）。
2.  **Input Area (Action Trigger)**
    *   **テキスト入力**: 複数行入力可能なテキストエリア。
    *   **実行ボタン**: エリアの右下または直下に、明確な「実行（送信）」ボタンを配置する。
        *   アイコン: 紙飛行機や再生マーク（▶）など。
    *   **ショートカット**: テキストエリアにフォーカス中、`Ctrl + Enter` (Macは `Cmd + Enter`) で実行可能とする。
3.  **History / Output View**
    *   **履歴リスト**: クリップボード履歴や過去の処理結果をカード形式でリスト表示する。
    *   **最新の応答**: AIからの翻訳結果や回答を表示するエリア。

## 3. 機能要件

### 3.1 クリップボード監視
*   バックグラウンドでクリップボードを監視し、新しいテキストがコピーされるたびに自動で履歴に追加する。
*   **UI連携**: 履歴が追加されたら、即座に画面上のリストを更新する。

### 3.2 入力処理フロー
ユーザーが「実行」アクション（ボタン押下 or ショートカット or D&D）を行った際、以下のフローを実行する。

1.  **入力判定**:
    *   テキストの場合: 言語判定へ。
    *   ファイルの場合: ファイル種別を判定し、パスを保持。必要に応じてテキスト抽出（OCR/文字起こし）プロセスへ回す（※将来実装）。
2.  **言語判定 & 自動翻訳**:
    *   入力が**日本語以外**の場合: 自動的に日本語へ翻訳し、結果を表示する。
    *   入力が**日本語**の場合: そのまま次のステップへ。
    *   *例外*: `no translate` 等のコマンドが含まれる場合は翻訳をスキップ。
3.  **対話待機**:
    *   翻訳結果（または原文）を表示した上で、「次に何をしますか？」とユーザーに問いかける状態にする。

## 4. データ管理
*   **保存**: すべての履歴と設定はローカルのJSONファイル (`history.json`, `settings.json`) に保存する。
*   **プライバシー**: 外部サーバーへの送信は、ユーザーが明示的にアクション（翻訳実行など）を行った場合のみとする。
